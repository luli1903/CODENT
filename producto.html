<!-- producto.html (versiÃ³n corregida, sin products.js) -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Producto - CODEN</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="css/style.css?v=101"/>
</head>
<body class="bg-light">
<nav class="navbar navbar-light coden-nav">
  <a class="navbar-brand font-weight-bold" href="index.html"><span class="brand-dot"></span> CODEN</a>
  <a href="carrito.html" class="btn btn-outline-primary btn-sm">
    ðŸ›’ <span id="cartBadge" class="badge badge-primary ml-1">0</span>
  </a>
</nav>

<div class="container py-4" id="content">
  <p class="text-muted">Cargandoâ€¦</p>
</div>

<script type="module" src="./supabaseClient.js?v=101"></script>
<script type="module">
  import { getProduct } from './db.js';
  // Si usas carrito local:
  import './js/cart.js'; // para que exista window.Cart/updateBadge si lo necesitas

  const qs = new URLSearchParams(location.search);
  const id = qs.get('id'); // UUID

  const root = document.getElementById('content');

  async function render() {
    if (!id) { root.innerHTML = '<p class="text-muted">Producto no encontrado.</p>'; return; }
    try {
      const p = await getProduct(id);
      if (!p) { root.innerHTML = '<p class="text-muted">Producto no encontrado.</p>'; return; }

      root.innerHTML = `
        <div class="row align-items-start">
          <div class="col-md-6 text-center mb-3">
            <img src="${p.image_url || ''}" alt="${p.name || ''}" class="img-fluid rounded" style="max-width:480px">
          </div>
          <div class="col-md-6">
            <h2 class="mb-1">${p.name || ''}</h2>
            <p class="text-muted">${p.description || ''}</p>
            <div class="h4 text-primary">$${Number(p.price||0).toLocaleString('es-AR')}</div>
            <div class="d-flex align-items-center my-3">
              <label class="mr-2 mb-0">Cantidad:</label>
              <input id="qty" type="number" min="1" value="1" class="form-control" style="width:100px">
            </div>
            <button id="addBtn" class="btn btn-primary">Agregar al carrito</button>
            <a href="tienda.html" class="btn btn-outline-primary ml-2">Volver a la tienda</a>
          </div>
        </div>
      `;

      const addBtn = document.getElementById('addBtn');
      addBtn.addEventListener('click', () => {
        const q = parseInt(document.getElementById('qty').value) || 1;
        // tu lÃ³gica de carrito (si usÃ¡s localStorage)
        window.Cart?.addItem({ id: p.id, name: p.name, price: p.price, image: p.image_url }, q);
        window.Cart?.updateCartBadge?.();
        alert('Producto agregado âœ”');
      });

      window.Cart?.updateCartBadge?.();
    } catch (e) {
      console.error(e);
      root.innerHTML = '<p class="text-muted">No se pudo cargar el producto.</p>';
    }
  }

  render();
</script>
</body>
</html>

